name: Start Cloudflare Worker

on:
  push:
    branches:
      - main
  workflow_dispatch:
  pull_request:
    branches:
      - main

jobs:
  start-worker:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, blacksmith-staging, blacksmith-2vcpu-ubuntu-2204]

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '16.x' # Specify the Node.js version you are using

      - name: Install dependencies
        run: |
          if [ -f package.json ]; then
            npm install
          else
            echo "No package.json found. Skipping dependency installation."
          fi

      - name: Start Cloudflare Unstable Dev Worker
        run: node start-worker.js
        # env:
          # CF_API_TOKEN: ${{ secrets.CF_API_TOKEN }} # Ensure you have this secret set in your repository

